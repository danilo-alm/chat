services:

  # gateway:
  #   build:
  #     context: .
  #     dockerfile: ./gateway/Dockerfile
  #   environment:
  #     REFLECTION: true

  user-service:
    build:
      context: .
      dockerfile: ./user-service/Dockerfile
    environment:
      REFLECTION: true

  user-db:
    image: mariadb:lts
    volumes:
      - user_data_dev:/var/lib/mysql

  auth-service:
    build:
      context: .
      dockerfile: ./auth-service/Dockerfile
    environment:
      ACCESS_TOKEN_SECRET: "${ACCESS_TOKEN_SECRET:-supersecrettoken}"
      REFRESH_TOKEN_SECRET: "${REFRESH_TOKEN_SECRET:-supersecretrefreshtoken}"
      REFLECTION: true

  auth-db:
    image: mariadb:lts
    volumes:
      - auth_data_dev:/var/lib/mysql
    
  last-seen-service:
    build:
      context: .
      dockerfile: ./last-seen-service/Dockerfile
    environment:
      REFLECTION: true

  last-seen-db:
    image: mongo:8.0
    volumes:
      - last_seen_data_dev:/data/db
  
  nginx:
    image: nginx:1.29-alpine
    ports:
      - "8080:80"
    volumes:
      - ./nginx_dev.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - auth-service
      - user-service
      - last-seen-service

volumes:
  last_seen_data_dev:
  auth_data_dev:
  user_data_dev:
